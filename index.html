<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üé≤ Dice Roller API Test</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
        line-height: 1.6;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 10px;
      }

      .subtitle {
        text-align: center;
        color: #7f8c8d;
        margin-bottom: 30px;
      }

      .endpoint {
        background: #f8f9fa;
        padding: 20px;
        margin: 20px 0;
        border-left: 4px solid #007bff;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .endpoint:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .endpoint h3 {
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .endpoint code {
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        color: #e83e8c;
      }

      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      button:hover:not(:disabled) {
        background: #0056b3;
        transform: translateY(-1px);
      }

      button:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
      }

      button.danger {
        background: #dc3545;
      }

      button.danger:hover:not(:disabled) {
        background: #c82333;
      }

      .result {
        background: #e9ecef;
        padding: 15px;
        margin: 15px 0;
        border-radius: 5px;
        white-space: pre-wrap;
        font-family: "Courier New", monospace;
        font-size: 14px;
        max-height: 300px;
        overflow-y: auto;
      }

      .status {
        padding: 8px 12px;
        border-radius: 4px;
        font-weight: bold;
        margin: 10px 0;
      }

      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
        vertical-align: middle;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .server-info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        border-left: 4px solid #007bff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé≤ Dice Roller API Test</h1>
      <p class="subtitle">
        Test the RESTful APIs for the Dice Roller application
      </p>

      <div class="server-info" id="serverInfo">
        Testing server at: <span id="serverUrl">Loading...</span>
      </div>

      <div class="endpoint">
        <h3>1. Wake Up Server</h3>
        <p>Endpoint: <code>GET /api/wakeup</code></p>
        <p>
          <small
            >Keeps the Azure App Service warm and checks server status</small
          >
        </p>
        <button onclick="testWakeUp()" id="wakeupBtn">Test Wake Up</button>
        <div id="wakeup-result"></div>
      </div>

      <div class="endpoint">
        <h3>2. Health Check</h3>
        <p>Endpoint: <code>GET /api/health</code></p>
        <p><small>Checks server health and system information</small></p>
        <button onclick="testHealth()" id="healthBtn">Test Health</button>
        <div id="health-result"></div>
      </div>

      <div class="endpoint">
        <h3>3. Roll Single Die</h3>
        <p>Endpoint: <code>GET /api/roll/single</code></p>
        <p><small>Rolls one six-sided die (d6)</small></p>
        <button onclick="rollSingle()" id="singleBtn">Roll Single Die</button>
        <div id="single-result"></div>
      </div>

      <div class="endpoint">
        <h3>4. Roll Multiple Dice</h3>
        <p>Endpoint: <code>GET /api/roll/multiple/:count</code></p>
        <p><small>Rolls multiple six-sided dice (1-100 dice)</small></p>
        <button onclick="rollMultiple(3)" id="multiple3Btn">Roll 3 Dice</button>
        <button onclick="rollMultiple(5)" id="multiple5Btn">Roll 5 Dice</button>
        <button onclick="rollMultiple(10)" id="multiple10Btn">
          Roll 10 Dice
        </button>
        <div id="multiple-result"></div>
      </div>

      <div class="endpoint">
        <h3>5. CORS Failure Demonstration</h3>
        <p>Endpoint: <code>GET /api/roll-dice</code></p>
        <p>
          <small
            >This endpoint intentionally causes CORS issues for
            demonstration</small
          >
        </p>
        <button class="danger" onclick="testCorsFailure()" id="corsBtn">
          Test CORS Failure
        </button>
        <div id="cors-result"></div>
      </div>

      <div class="endpoint">
        <h3>6. Test All APIs</h3>
        <p><small>Run comprehensive tests on all API endpoints</small></p>
        <button onclick="testAll()" id="allBtn">Run All Tests</button>
        <div id="all-results"></div>
      </div>
    </div>

    <script>
      const baseUrl = window.location.origin;
      let isTesting = false;

      // Display server URL
      document.getElementById("serverUrl").textContent = baseUrl;

      function setButtonLoading(buttonId, isLoading) {
        const button = document.getElementById(buttonId);
        if (isLoading) {
          button.innerHTML = '<span class="loading"></span> Loading...';
          button.disabled = true;
        } else {
          button.innerHTML = button.textContent
            .replace("Loading...", "")
            .trim();
          button.disabled = false;
        }
      }

      function displayResult(elementId, data, isError = false) {
        const element = document.getElementById(elementId);
        const status = isError ? "error" : "success";
        const statusText = isError ? "‚ùå Error" : "‚úÖ Success";

        element.innerHTML = `
                <div class="status ${status}">${statusText}</div>
                <div class="result">${JSON.stringify(data, null, 2)}</div>
            `;
      }

      function displayInfo(elementId, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `
                <div class="status info">‚ÑπÔ∏è ${message}</div>
            `;
      }

      async function testWakeUp() {
        setButtonLoading("wakeupBtn", true);
        try {
          const response = await fetch(`${baseUrl}/api/wakeup`);
          const data = await response.json();
          displayResult("wakeup-result", data);
        } catch (error) {
          displayResult(
            "wakeup-result",
            {
              error: error.message,
              note: "Check if server is running and accessible",
            },
            true
          );
        } finally {
          setButtonLoading("wakeupBtn", false);
        }
      }

      async function testHealth() {
        setButtonLoading("healthBtn", true);
        try {
          const response = await fetch(`${baseUrl}/api/health`);
          const data = await response.json();
          displayResult("health-result", data);
        } catch (error) {
          displayResult(
            "health-result",
            {
              error: error.message,
            },
            true
          );
        } finally {
          setButtonLoading("healthBtn", false);
        }
      }

      async function rollSingle() {
        setButtonLoading("singleBtn", true);
        try {
          const response = await fetch(`${baseUrl}/api/roll/single`);
          const data = await response.json();
          displayResult("single-result", data);
        } catch (error) {
          displayResult(
            "single-result",
            {
              error: error.message,
            },
            true
          );
        } finally {
          setButtonLoading("singleBtn", false);
        }
      }

      async function rollMultiple(count) {
        const buttonId = `multiple${count}Btn`;
        setButtonLoading(buttonId, true);
        try {
          const response = await fetch(`${baseUrl}/api/roll/multiple/${count}`);
          const data = await response.json();
          displayResult("multiple-result", data);
        } catch (error) {
          displayResult(
            "multiple-result",
            {
              error: error.message,
            },
            true
          );
        } finally {
          setButtonLoading(buttonId, false);
        }
      }

      async function testCorsFailure() {
        setButtonLoading("corsBtn", true);
        try {
          const response = await fetch(`${baseUrl}/api/roll-dice`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          displayResult("cors-result", {
            ...data,
            note: "Unexpected success - CORS might be configured differently than expected",
          });
        } catch (error) {
          displayResult(
            "cors-result",
            {
              error: error.message,
              note: "This is the expected CORS failure when called from browser due to missing CORS headers",
              type: "CORS Error",
            },
            true
          );
        } finally {
          setButtonLoading("corsBtn", false);
        }
      }

      async function testAll() {
        if (isTesting) return;
        isTesting = true;
        setButtonLoading("allBtn", true);

        const results = document.getElementById("all-results");
        results.innerHTML =
          '<div class="status info">üöÄ Running all API tests...</div>';

        const tests = [
          { name: "Wake Up", fn: testWakeUp, btn: "wakeupBtn" },
          { name: "Health Check", fn: testHealth, btn: "healthBtn" },
          { name: "Single Roll", fn: rollSingle, btn: "singleBtn" },
          {
            name: "Multiple Roll",
            fn: () => rollMultiple(3),
            btn: "multiple3Btn",
          },
          { name: "CORS Test", fn: testCorsFailure, btn: "corsBtn" },
        ];

        for (const test of tests) {
          displayInfo("all-results", `Running: ${test.name}...`);
          await test.fn();
          await new Promise((resolve) => setTimeout(resolve, 1000)); // Delay between tests
        }

        results.innerHTML +=
          '<div class="status success">üéâ All tests completed!</div>';
        setButtonLoading("allBtn", false);
        isTesting = false;
      }

      // Auto-test wakeup on page load
      window.addEventListener("load", () => {
        displayInfo("wakeup-result", "Auto-testing server connection...");
        setTimeout(() => testWakeUp(), 500);
      });
    </script>
  </body>
</html>
